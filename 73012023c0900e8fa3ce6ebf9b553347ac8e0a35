{
  "comments": [
    {
      "key": {
        "uuid": "d5ab92d0_5a30839b",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 5965
      },
      "writtenOn": "2017-08-31T16:24:32Z",
      "side": 1,
      "message": "Can we make m_pDocument a UnownedPtr and then do something like:\n\nstd::pair... ParseDocument(const char* password) {\n  if (m_pDocument)\n    return {CPDF_Parser::HANDLER_ERROR, nullptr}\n\n  auto parser \u003d pdfium::MakeUnique\u003cCPDF_Parser\u003e();\n  parser-\u003eSetPassword(password);\n\n  auto document \u003d pdfium::MakeUnique\u003cCPDF_Document\u003e(std::move(parser));\n\n  CPDF_ReadValidator::Session read_session(GetValidator().Get());\n  CPDF_Parser::Error error \u003d document-\u003eGetParser()-\u003eStartLinearizedParse(\n      GetFileRead(), document.get());\n  // Additional check, that all ok.\n  if (GetValidator()-\u003ehas_read_problems())\n    return {CPDF_Parser::HANDLER_ERROR, nullptr};\n\n  if (error \u003d\u003d CPDF_Parser::SUCCESS)\n    m_pDocument \u003d document.get();\n  return {error, document};\n}",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c7583845_e4e939f0",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 7160
      },
      "writtenOn": "2017-08-31T16:47:10Z",
      "side": 1,
      "message": "No. We parse document before user request it, to detect read problems, and request additional data by DownloadHints. \nBut if it is parsed (in CPDF_DataAvail::IsDocAvail), we should store it, to return it to user when he request it, without reparsing.",
      "parentUuid": "d5ab92d0_5a30839b",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ece08045_cfcf2a99",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 5965
      },
      "writtenOn": "2017-08-31T17:24:30Z",
      "side": 1,
      "message": "Which the above does, at least, it does what ParseDocument did previously. If you successfully parse, set m_pDocument and return it.\n\nThis should be the same as what you have in ParseDocument and ParseDocumentInternal is it not?",
      "parentUuid": "c7583845_e4e939f0",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6fa45ea4_c48a62f5",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 7160
      },
      "writtenOn": "2017-09-01T13:46:49Z",
      "side": 1,
      "message": "Let compare my solution (with CFX_MayBeOwnedPtr) with this:\n\nThis is generic api call logic:\n\nDownloadHints hints;\nFPDF_AVAIL avail \u003d FPDFAvail_Create(...);\n// ...\nwhile(FPDFAvail_IsDocAvail(avail, hints) \u003d\u003d DataNotAvail) {\n// Download requested by hints data.\n}\n\ndocument \u003d FPDFAvail_GetDocument(avail);\n\nin my solution I parse the document on last call of FPDFAvail_IsDocAvail and temporary own it in \"CFX_MayBeOwnedPtr m_pDocument\".\nAnd if something wrong, i have chance to request whole file using \"hints\", and try parse again, when whole file will be available.\nAnd when all will be ok (or already ok), just unown the document on call FPDFAvail_GetDocument and return it.\n\nIn your solution i should parse document only in FPDFAvail_GetDocument to immediately return it to caller without owning,\nBut if something wrong, i have not already the \"hints\" at this point and have not chance to request additional data, which needs to parse.\nAs result i should return \"HANDLER_ERROR\". And we have got strange logic, that FPDFAvail_IsDocAvail returned DataAvail, but FPDFAvail_GetDocument returned HANDLER_ERROR. \nAnd the document will be not opened, but can be, if we load whole file.",
      "parentUuid": "ece08045_cfcf2a99",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fca32b00_50097ab5",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 5965
      },
      "writtenOn": "2017-09-06T20:40:20Z",
      "side": 1,
      "message": "Why are you setting hints after parsing the document? The hints are needed to get the document so they should be set first, no?",
      "parentUuid": "6fa45ea4_c48a62f5",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b4de454_17867c61",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1623,
      "author": {
        "id": 7160
      },
      "writtenOn": "2017-09-07T12:39:29Z",
      "side": 1,
      "message": "I set hints first, before parsing document. What case do you mean?",
      "parentUuid": "fca32b00_50097ab5",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d91d1f8d_e6f04d7c",
        "filename": "fpdfsdk/fpdf_dataavail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 5965
      },
      "writtenOn": "2017-08-31T16:24:32Z",
      "side": 1,
      "message": "CPDF_Parser::Error error;\nstd::unique_ptr\u003cCPDF_Document\u003e doc;\nstd::tie(err, doc) \u003d pDataAvail-\u003em_pDataAvail-\u003eParseDocument(password);",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1b26eb4_5cd324b7",
        "filename": "fpdfsdk/fpdf_dataavail.cpp",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 7160
      },
      "writtenOn": "2017-08-31T16:47:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d91d1f8d_e6f04d7c",
      "revId": "73012023c0900e8fa3ce6ebf9b553347ac8e0a35",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": false
    }
  ]
}